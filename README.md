
1. **Создание сделки в CoMagic\UIS**
   - При создании нового "Интереса" в 1С, который связан с новым обращением (звонок, заявка и т.д.), необходимо создать соответствующую сделку в CoMagic\UIS.
   - Для этого нужно использовать метод `create.deal_contacts` из документации CoMagic\UIS API.
   - В параметрах запроса необходимо передать следующие данные:
     - `ext_id`: уникальный идентификатор "Интереса" в 1С (например, код или ссылка на объект)
     - `name`: название "Интереса"
     - `created_date_time`: дата и время создания "Интереса" в 1С
     - `phone_numbers`: номер телефона, связанный с обращением
     - `emails`: email, если есть, связанный с обращением
   - Также необходимо передать `communication_id` из обращения в одном из пользовательских полей сделки (`user_fields`). Это позволит в дальнейшем сопоставлять сделку с соответствующим обращением в CoMagic\UIS.
   - Пример запроса:

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "create.deal_contacts",
  "params": {
    "access_token": "ваш_access_token",
    "contacts": [
      {
        "ext_id": "INTxxxxxxxx",
        "name": "Новый интерес",
        "created_date_time": "2023-04-01 10:00:00",
        "phone_numbers": [
          "+79991234567"
        ],
        "emails": [
          "email@example.com"
        ],
        "user_fields": [
          {
            "ext_id": "communication_id",
            "value": "12345678"
          }
        ]
      }
    ]
  }
}
```

2. **Обновление статуса сделки в CoMagic\UIS**
   - При изменении статуса "Интереса" в 1С необходимо обновить соответствующую сделку в CoMagic\UIS.
   - Для этого нужно использовать метод `upload.deals_history` из документации CoMagic\UIS API.
   - В параметрах запроса необходимо передать следующие данные:
     - `ext_id`: уникальный идентификатор "Интереса" в 1С (тот же, что и при создании сделки)
     - `modified_date_time`: дата и время изменения "Интереса" в 1С
     - `sales_funnel_ext_id`: Идентификатор воронки
     - `modified_stage_date_time`: дата и время изменения статуса "Интереса" в 1С
     - `stage_ext_id`: идентификатор этапа воронки продаж в CoMagic\UIS, соответствующий новому статусу "Интереса"
   - Также можно обновить другие поля сделки, такие как `name`, `revenue`, `comments` и т.д., если они изменились в 1С.
   - Пример запроса:

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "upload.deals_history",
  "params": {
    "access_token": "ваш_access_token",
    "deals": [
      {
        "ext_id": "INTxxxxxxxx",
        "name": "Обновленный интерес",
        "modified_date_time": "2023-04-02 14:30:00",
        "modified_stage_date_time": "2023-04-02 14:30:00",
        "stage_ext_id": "STAGEyyyyyy",
        "revenue": 50000,
        "sales_funnel_ext_id": "123"
      }
    ]
  }
}
```



3. **Обновление данных контакта**
   - Если в 1С изменились контактные данные "Интереса" (номер телефона, email и т.д.), необходимо обновить соответствующий контакт в CoMagic\UIS.
   - Для этого нужно использовать метод `update.deal_contacts` из документации CoMagic\UIS API.
   - В параметрах запроса необходимо передать `ext_id` контакта (идентификатор "Интереса" в 1С) и обновленные данные (`name`, `phone_numbers`, `emails` и т.д.).

Таким образом, при создании нового "Интереса" в 1С, связанного с обращением в CoMagic\UIS, будет создаваться соответствующая сделка. При изменении статуса "Интереса" в 1С, будет обновляться этап сделки в CoMagic\UIS. Сопоставление сделки с обращением будет осуществляться по `communication_id`, который передается в пользовательском поле сделки при ее создании.

Обратите внимание, что перед началом работы необходимо выполнить следующие подготовительные шаги:

1. Создать воронку продаж и этапы в CoMagic\UIS, соответствующие статусам "Интересов" в 1С.
2. Получить `access_token` для авторизации в CoMagic\UIS API.
3. Определить идентификаторы этапов воронки продаж (`stage_ext_id`) в CoMagic\UIS, соответствующие статусам "Интересов" в 1С.




4. **Сопоставление сделки с обращением**
ЕСЛИ КОГДА-ТО ПОНАДОБИТСЯ для каких-то выгрузок. Пока не надо реализовывать. 
   - Для сопоставления сделки с соответствующим обращением в CoMagic\UIS необходимо использовать `communication_id`, который был передан в пользовательском поле сделки при ее создании.
   - В 1С можно выполнить запрос к CoMagic\UIS API, используя метод `get.deals_history`, и получить список сделок, отфильтровав их по пользовательскому полю `communication_id`.
   - Пример запроса:

```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "get.deals_history",
  "params": {
    "access_token": "ваш_access_token",
    "filter": {
      "user_fields": [
        {
          "ext_id": "communication_id",
          "value": "12345678"
        }
      ]
    }
  }
}
```

   - Полученные сделки будут соответствовать обращению с `communication_id` 12345678.
